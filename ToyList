-------------------------------------------------
-- DANH S√ÅCH H√ÄNH ƒê·ªòNG TOY
-------------------------------------------------
local toyActions = {}

toyActions["FakeBomb"] = function()
    -- 1. Y√™u c·∫ßu server spawn FakeBomb
    local args = { "FakeBomb" }
    local success, err = pcall(function()
        ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Extras"):WaitForChild("ReplicateToy"):InvokeServer(unpack(args))
    end)
    if not success then
        warn("‚ùå L·ªói spawn FakeBomb:", err)
        return
    end
    print("‚úÖ ƒê√£ y√™u c·∫ßu server spawn FakeBomb")

    -- 2. Ch·ªù xu·∫•t hi·ªán r·ªìi n√©m
    task.spawn(function()
        for _ = 1, 50 do
            task.wait(0.1)
            local bomb = LocalPlayer.Character:FindFirstChild("FakeBomb")
            if bomb and bomb:FindFirstChild("Remote") then
                print("üì¶ FakeBomb ƒë√£ spawn")
                task.wait(0.5)
                local hrp = LocalPlayer.Character:WaitForChild("HumanoidRootPart")
                local throwArgs = {
                    hrp.CFrame * CFrame.new(0, 0, -2),
                    50
                }
                bomb.Remote:FireServer(unpack(throwArgs))
                print("üí£ ƒê√£ n√©m FakeBomb")
                break
            end
        end
    end)
end

toyActions["BeachBall2023"] = function()
    local args = { "BeachBall2023" }
    local success, err = pcall(function()
        ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Extras"):WaitForChild("ReplicateToy"):InvokeServer(unpack(args))
    end)
    if not success then
        warn("‚ùå L·ªói spawn BeachBall2023:", err)
        return
    end
    print("‚úÖ ƒê√£ y√™u c·∫ßu server spawn BeachBall2023")

    task.spawn(function()
        for _ = 1, 50 do
            task.wait(0.1)
            local beachBall = LocalPlayer.Character:FindFirstChild("BeachBall2023")
            if beachBall then
                print("üèê BeachBall2023 ƒë√£ spawn")
                task.wait(0.5)

                -- H√†m t√¨m RemoteEvent trong nil
                local function getNil(name, class)
                    for _, v in next, getnilinstances() do
                        if v.ClassName == class and v.Name == name then
                            return v
                        end
                    end
                end

                local remote = getNil("Remote", "RemoteEvent")
                if remote then
                    local hrp = LocalPlayer.Character:WaitForChild("HumanoidRootPart")
                    local targetPos = hrp.Position + hrp.CFrame.LookVector * 5
                    local args = { Vector3.new(targetPos.X, targetPos.Y, targetPos.Z) }
                    remote:FireServer(unpack(args))
                    print("üéØ ƒê√£ n√©m BeachBall2023")
                else
                    warn("‚ùå Kh√¥ng t√¨m th·∫•y RemoteEvent cho BeachBall2023")
                end
                break
            end
        end
    end)
end

toyActions["WaterBalloon2024"] = function()
    -- 1. Spawn t·ª´ server
    local args = { "WaterBalloon2024" }
    local success, err = pcall(function()
        ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Extras"):WaitForChild("ReplicateToy"):InvokeServer(unpack(args))
    end)
    if not success then
        warn("‚ùå L·ªói spawn WaterBalloon2024:", err)
        return
    end
    print("‚úÖ ƒê√£ y√™u c·∫ßu server spawn WaterBalloon2024")

    task.spawn(function()
        for _ = 1, 50 do
            task.wait(0.1)
            local balloon = LocalPlayer.Character:FindFirstChild("WaterBalloon2024")
            if balloon and balloon:FindFirstChild("Remote") then
                print("üí¶ WaterBalloon2024 ƒë√£ spawn")
                task.wait(0.3)

                local hrp = LocalPlayer.Character:WaitForChild("HumanoidRootPart")
                local startPos = hrp.Position + hrp.CFrame.LookVector * 3
                local endPos = startPos + Vector3.new(0, -3, 0) -- ƒëi·ªÉm r∆°i th·∫•p h∆°n

                local args = { startPos, endPos }
                balloon.Remote:FireServer(unpack(args))
                print("üéØ ƒê√£ n√©m WaterBalloon2024")
                break
            end
        end
    end)
end

toyActions["Fireflies"] = function()
    -- 1. Spawn t·ª´ server
    local args = { "Fireflies" }
    local success, err = pcall(function()
        ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Extras"):WaitForChild("ReplicateToy"):InvokeServer(unpack(args))
    end)
    if not success then
        warn("‚ùå L·ªói spawn Fireflies:", err)
        return
    end
    print("‚úÖ ƒê√£ y√™u c·∫ßu server spawn Fireflies")

    -- 2. Ch·ªù toy spawn v√† InvokeServer
    task.spawn(function()
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local fireflies = char:WaitForChild("Fireflies", 5)
        if fireflies then
            local remote = fireflies:WaitForChild("Remote", 5)
            if remote and remote:IsA("RemoteFunction") then
                remote:InvokeServer("Button1Down")
                print("‚ú® ƒê√£ k√≠ch ho·∫°t Fireflies")
            else
                warn("‚ùå Kh√¥ng t√¨m th·∫•y RemoteFunction c·ªßa Fireflies")
            end
        else
            warn("‚ùå Kh√¥ng t√¨m th·∫•y tool Fireflies")
        end
    end)
end

toyActions["SandBucket2024"] = function()
    -- 1. Spawn toy t·ª´ server
    local args = { "SandBucket2024" }
    local success, err = pcall(function()
        game:GetService("ReplicatedStorage")
            :WaitForChild("Remotes")
            :WaitForChild("Extras")
            :WaitForChild("ReplicateToy")
            :InvokeServer(unpack(args))
    end)
    if not success then
        warn("‚ùå L·ªói spawn SandBucket2024:", err)
        return
    end
    print("‚úÖ ƒê√£ y√™u c·∫ßu server spawn SandBucket2024")

    -- 2. Ch·ªù tool xu·∫•t hi·ªán trong nh√¢n v·∫≠t v√† fire remote
    task.spawn(function()
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local bucket = char:WaitForChild("SandBucket2024", 5)
        if bucket then
            -- L·∫•y danh s√°ch part h·ª£p l·ªá
            local allParts = {}
            for _, obj in ipairs(workspace:GetDescendants()) do
                if obj:IsA("BasePart") and obj:IsDescendantOf(workspace.Lobby) then
                    table.insert(allParts, obj)
                end
            end

            if #allParts == 0 then
                warn("‚ùå Kh√¥ng t√¨m th·∫•y part h·ª£p l·ªá cho SandBucket2024")
                return
            end

            -- Ch·ªçn part ng·∫´u nhi√™n
            local targetPart = allParts[math.random(1, #allParts)]

            -- T·∫°o targetPos ng·∫´u nhi√™n quanh part
            local randomOffset = Vector3.new(
                math.random(-3, 3),  -- ¬±3 studs X
                0,
                math.random(-3, 3)   -- ¬±3 studs Z
            )
            local targetPos = targetPart.Position + randomOffset

            -- G·ª≠i l·ªánh FireServer
            local remote = bucket:FindFirstChildWhichIsA("RemoteEvent", true)
            if remote then
                remote:FireServer(targetPart, targetPos)
                print(("üèñÔ∏è ƒê√£ s·ª≠ d·ª•ng SandBucket2024 t·∫°i %s"):format(tostring(targetPos)))
            else
                warn("‚ùå Kh√¥ng t√¨m th·∫•y RemoteEvent trong SandBucket2024")
            end
        else
            warn("‚ùå Kh√¥ng t√¨m th·∫•y tool SandBucket2024 trong nh√¢n v·∫≠t")
        end
    end)
end

toyActions["VolleyBall2025"] = function()
    -- 1. Spawn t·ª´ server
    local args = { "VolleyBall2025" }
    local success, err = pcall(function()
        game:GetService("ReplicatedStorage")
            :WaitForChild("Remotes")
            :WaitForChild("Extras")
            :WaitForChild("ReplicateToy")
            :InvokeServer(unpack(args))
    end)
    if not success then
        warn("‚ùå L·ªói spawn VolleyBall2025:", err)
        return
    end
    print("üèê ƒê√£ y√™u c·∫ßu server spawn VolleyBall2025")

    -- 2. Ch·ªù tool trong nh√¢n v·∫≠t v√† fire remote
    task.spawn(function()
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local ball = char:WaitForChild("VolleyBall2025", 5)
        if ball then
            -- Random m·ªôt v·ªã tr√≠ quanh nh√¢n v·∫≠t
            local hrp = char:WaitForChild("HumanoidRootPart")
            local randomOffset = Vector3.new(
                math.random(-10, 10), -- X
                math.random(0, 5),    -- Y
                math.random(-10, 10)  -- Z
            )
            local targetPos = hrp.Position + randomOffset

            -- FireServer
            local remote = ball:FindFirstChild("Remote")
            if remote and remote:IsA("RemoteEvent") then
                remote:FireServer(targetPos)
                print(("‚úÖ ƒê√£ n√©m VolleyBall2025 t·ªõi %s"):format(tostring(targetPos)))
            else
                warn("‚ùå Kh√¥ng t√¨m th·∫•y RemoteEvent trong VolleyBall2025")
            end
        else
            warn("‚ùå Kh√¥ng t√¨m th·∫•y tool VolleyBall2025 trong nh√¢n v·∫≠t")
        end
    end)
end
